<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.323">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>methods-results</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="methods-results_files/libs/clipboard/clipboard.min.js"></script>
<script src="methods-results_files/libs/quarto-html/quarto.js"></script>
<script src="methods-results_files/libs/quarto-html/popper.min.js"></script>
<script src="methods-results_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="methods-results_files/libs/quarto-html/anchor.min.js"></script>
<link href="methods-results_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="methods-results_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="methods-results_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="methods-results_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="methods-results_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">methods-results</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The purpose of these studies was to develop, refine, and provide validity and reliability evidence for scales intended to measure the individuals’ harm reduction orientation. We conducted a series of qualitative studies to ensure that individuals who are not familiar with harm reduction orientation shared the intended meaning of the items. We then conducted several sequential quantitative studies to identify and confirm hypothetical factor structures, then to provide validity evidence for our scales.</p>
<section id="study-1" class="level1">
<h1>Study 1</h1>
<section id="item-generation" class="level2">
<h2 class="anchored" data-anchor-id="item-generation">Item Generation</h2>
<p>Item generation was undertaken in several stages. The first step in item generation consisted of items generated in two scales (harm reduction principles and harm reduction strategies) which were drafted by the authors and piloted with harm reduction workers in local training and harm reduction supply distribution evaluation. Following the initial pilot project, we revised and added items to address gaps that had been noted. The items were generated with regard to both the SAMHSA Harm Reduction Framework (cite) and the National Harm Reduction Coalition’s Harm Reduction Principles (). Once the initial item pool was generated, we consulted with Dr.&nbsp;David Frank, a harm reduction expert and researcher. Based on his consultation, items were further modified to be accessible to a general population.</p>
<p>We used Wolf et al’s (2023) Response Process Evaluation (RPE) method to ensure that a non-expert, non-harm reduction audience would understand the item content. Over X rounds of data collection, we used Prolific to collect qualitative responses to each item. As a group, we evaluated each set of responses to determine whether respondents understood or did not understand the intended meaning of each item. Based on respondent answers and suggestions, we identified items which items were generally understood, and which items should be modified or removed. The RPE data, item information and intended meanings, and author codings are available at . Table 1 contains the final items that were used for the initial round of quantitative data collection.</p>
<p>The final item pool contained 45 items related to harm reduction strategies and Y items related to harm reduction principals. There are z total reverse scored items (x in scale 1, y in scale 2). These items cover a, b, c, concepts relate to harm reduction practice. We phrased strategy items to ask about respondents moral assessment of the practice occurring, rather than to ask about the approval of the actual practice. We phrased the principal items as simply and directly as possible, occasionally splitting complex topics (experiences of discrimination, other topic) across multiple items when necessary. The aim of study 1 is to identify items to retain in future scales and scale factor structure.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.1     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ ggplot2::%+%()   masks psych::%+%()
✖ ggplot2::alpha() masks psych::alpha()
✖ dplyr::filter()  masks stats::filter()
✖ dplyr::lag()     masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors
New names:</code></pre>
</div>
<div class="cell-output-display">

<div id="hcaxlcdawn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hcaxlcdawn table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hcaxlcdawn thead, #hcaxlcdawn tbody, #hcaxlcdawn tfoot, #hcaxlcdawn tr, #hcaxlcdawn td, #hcaxlcdawn th {
  border-style: none;
}

#hcaxlcdawn p {
  margin: 0;
  padding: 0;
}

#hcaxlcdawn .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hcaxlcdawn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hcaxlcdawn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hcaxlcdawn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hcaxlcdawn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hcaxlcdawn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hcaxlcdawn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hcaxlcdawn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hcaxlcdawn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hcaxlcdawn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hcaxlcdawn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hcaxlcdawn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hcaxlcdawn .gt_spanner_row {
  border-bottom-style: hidden;
}

#hcaxlcdawn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hcaxlcdawn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hcaxlcdawn .gt_from_md > :first-child {
  margin-top: 0;
}

#hcaxlcdawn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hcaxlcdawn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hcaxlcdawn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hcaxlcdawn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hcaxlcdawn .gt_row_group_first td {
  border-top-width: 2px;
}

#hcaxlcdawn .gt_row_group_first th {
  border-top-width: 2px;
}

#hcaxlcdawn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcaxlcdawn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hcaxlcdawn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hcaxlcdawn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hcaxlcdawn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcaxlcdawn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hcaxlcdawn .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hcaxlcdawn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hcaxlcdawn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hcaxlcdawn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hcaxlcdawn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcaxlcdawn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hcaxlcdawn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hcaxlcdawn .gt_left {
  text-align: left;
}

#hcaxlcdawn .gt_center {
  text-align: center;
}

#hcaxlcdawn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hcaxlcdawn .gt_font_normal {
  font-weight: normal;
}

#hcaxlcdawn .gt_font_bold {
  font-weight: bold;
}

#hcaxlcdawn .gt_font_italic {
  font-style: italic;
}

#hcaxlcdawn .gt_super {
  font-size: 65%;
}

#hcaxlcdawn .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hcaxlcdawn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hcaxlcdawn .gt_indent_1 {
  text-indent: 5px;
}

#hcaxlcdawn .gt_indent_2 {
  text-indent: 10px;
}

#hcaxlcdawn .gt_indent_3 {
  text-indent: 15px;
}

#hcaxlcdawn .gt_indent_4 {
  text-indent: 20px;
}

#hcaxlcdawn .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="1" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">Table 1: Initial Item Set</td>
    </tr>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Item">Item</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="item" class="gt_row gt_left">People who inject drugs should be able to do so in a way that prevents them from causing further harm to their health.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People should have access to tools for safer sex (like condoms, STD tests).</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should have access to naloxone/NARCAN.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">The general public should have access to naloxone/NARCAN.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Police officers should have access to naloxone/NARCAN.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should have access to tools to test what's in their drugs.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should have access to safe injection supplies (sterile needles and syringes).</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should have access to safe inhalation supplies (glass stems and pipes).</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who actively use drugs should have access to therapy/counseling.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who return to using drugs after a period of abstinence should be allowed to continue in treatment.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Sobriety should be required for treatment.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Medications used to treat addiction (buprenorphine, naltrexone, or methadone) are an appropriate treatment option for people who use drugs.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Possession of "drug paraphernalia", like syringes and pipes, should be legal.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who seek medical assistance for overdoses should be protected from drug charges, arrests, and prosecutions.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Sobriety should not be a requirement to access public housing.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Possession of all drugs should be decriminalized (possession would not lead to legal repercussions).</td></tr>
    <tr><td headers="item" class="gt_row gt_left">It should be legal for adults to purchase drugs from a dispensary/shop.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should have access to supervised places where they can consume drugs safely.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should have access to a legal, non-contaminated drug supply.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People use drugs to escape.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People should be able to use drugs safely.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should be treated with respect.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Poverty affects the health of people who use drugs.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Racism affects the health of people who use drugs.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Gender-based discrimination affects the health of people who use drugs.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Some ways of using drugs are safer than others.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs deserve to live good lives.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Reducing drug use is a reasonable goal for people who use drugs.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Some people who use drugs cannot be expected to quit immediately.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should be involved in creating the programs and policies that serve them.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People in recovery from drug use should be involved in creating the programs and policies that serve them.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Relapse may be a part of the recovery process.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">It is possible to live a healthy life without stopping drug use.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should be forced into treatment.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Using drugs is immoral.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Drug use has benefits.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Harm reduction complements traditional addiction prevention, treatment, and recovery services.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs benefit society.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Reducing the negative consequences of drug use encourages more people to use drugs.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People will use more drugs if it is safer.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs will naturally end up homeless.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Drugs make the world worse.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Drug use will always be part of society.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">Chaotic drug use is a rational response to experiences like trauma, homelessness, hunger, and poverty.</td></tr>
    <tr><td headers="item" class="gt_row gt_left">People who use drugs should be able to use medications used to treat addiction (buprenorphine, naltrexone, or methadone) for any length of time.</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<p>We recruited 301 participants from Prolific.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>